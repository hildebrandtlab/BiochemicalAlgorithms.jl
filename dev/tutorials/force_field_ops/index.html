<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>How to apply force fields · BiochemicalAlgorithms.jl</title><meta name="title" content="How to apply force fields · BiochemicalAlgorithms.jl"/><meta property="og:title" content="How to apply force fields · BiochemicalAlgorithms.jl"/><meta property="twitter:title" content="How to apply force fields · BiochemicalAlgorithms.jl"/><meta name="description" content="Documentation for BiochemicalAlgorithms.jl."/><meta property="og:description" content="Documentation for BiochemicalAlgorithms.jl."/><meta property="twitter:description" content="Documentation for BiochemicalAlgorithms.jl."/><meta property="og:url" content="https://hildebrandtlab.github.io/BiochemicalAlgorithms.jl/tutorials/force_field_ops/"/><meta property="twitter:url" content="https://hildebrandtlab.github.io/BiochemicalAlgorithms.jl/tutorials/force_field_ops/"/><link rel="canonical" href="https://hildebrandtlab.github.io/BiochemicalAlgorithms.jl/tutorials/force_field_ops/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">BiochemicalAlgorithms.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../getting_started/">How to get started</a></li><li><a class="tocitem" href="../iterate/">How to iterate</a></li><li><a class="tocitem" href="../read_and_write/">How to read and write</a></li><li><a class="tocitem" href="../handle_molecules/">How to handle molecules</a></li><li class="is-active"><a class="tocitem" href>How to apply force fields</a><ul class="internal"><li><a class="tocitem" href="#Preparation"><span>Preparation</span></a></li><li><a class="tocitem" href="#Setting-up-a-force-field"><span>Setting up a force field</span></a></li><li><a class="tocitem" href="#Force-computation"><span>Force computation</span></a></li><li><a class="tocitem" href="#Potential-energy-computation"><span>Potential energy computation</span></a></li><li><a class="tocitem" href="#Structure-optimization"><span>Structure optimization</span></a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../public/system/">Biomolecular systems</a></li><li><a class="tocitem" href="../../public/fileformats/">File formats</a></li><li><a class="tocitem" href="../../public/forcefields/">Force fields</a></li><li><a class="tocitem" href="../../public/mappings/">Mappings</a></li><li><a class="tocitem" href="../../public/preprocessing/">Molecular preprocessing</a></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../private/fileformats/">File Formats</a></li><li><a class="tocitem" href="../../private/system/">Biomolecular systems</a></li><li><a class="tocitem" href="../../private/mappings/">Mappings</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>How to apply force fields</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>How to apply force fields</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/hildebrandtlab/BiochemicalAlgorithms.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/hildebrandtlab/BiochemicalAlgorithms.jl/blob/develop/docs/src/tutorials/force_field_ops.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Working-with-force-fields"><a class="docs-heading-anchor" href="#Working-with-force-fields">Working with force fields</a><a id="Working-with-force-fields-1"></a><a class="docs-heading-anchor-permalink" href="#Working-with-force-fields" title="Permalink"></a></h1><h2 id="Preparation"><a class="docs-heading-anchor" href="#Preparation">Preparation</a><a id="Preparation-1"></a><a class="docs-heading-anchor-permalink" href="#Preparation" title="Permalink"></a></h2><p>Force fields in BiochemicalAlgorithms.jl are always set up for a given molecular system. Hence, we first need to prepare a <code>System</code> object <a href="../getting_started/">as usual</a>, e.g., by loading a structure from a PDB file and applying our fragment database preprocessors:</p><pre><code class="language-julia hljs">sys = load_pdb(ball_data_path(&quot;../test/data/AlaAla.pdb&quot;))

fdb = FragmentDB()
normalize_names!(sys, fdb)
reconstruct_fragments!(sys, fdb)
build_bonds!(sys, fdb)

sys</code></pre><pre><code class="nohighlight hljs">[ Info: reconstruct_fragments!(): added 0 atoms.
[ Info: build_bonds!(): built 22 bonds

System{Float32}: AlaAla.pdb
  23 atoms
  22 bonds
   1 molecules
   1 chains
   0 secondary structures
   2 fragments</code></pre><h2 id="Setting-up-a-force-field"><a class="docs-heading-anchor" href="#Setting-up-a-force-field">Setting up a force field</a><a id="Setting-up-a-force-field-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-a-force-field" title="Permalink"></a></h2><p>Setting up a force field boils down to a simple constructor call:</p><pre><code class="language-julia hljs">ff = AmberFF(sys)</code></pre><pre><code class="nohighlight hljs">┌ Warning: 2 warnings occurred during setup that were suppressed:
│  - Torsion: 2 warnings
│ Use print_warnings(ff) to display them.
└ @ BiochemicalAlgorithms ~/git/ball.jl/src/forcefields/common/forcefield.jl:233

AmberFF for 23 atoms with 22 bonds.</code></pre><p>This will initialize the force field object using the atoms (and their positions in particular) as seen at time of construction. Later alterations of the same system must be made known to the force field by calling the <code>update!</code> function:</p><pre><code class="language-julia hljs">update!(ff)</code></pre><h2 id="Force-computation"><a class="docs-heading-anchor" href="#Force-computation">Force computation</a><a id="Force-computation-1"></a><a class="docs-heading-anchor-permalink" href="#Force-computation" title="Permalink"></a></h2><p>Force vectors for all atoms can be computed using the <code>compute_forces!</code> function:</p><pre><code class="language-julia hljs">compute_forces!(ff)</code></pre><p>The force vectors computed here are directly stored in the underlying system:</p><pre><code class="language-julia hljs">atoms(sys).F   # or, equivalently, atoms(ff.system).F</code></pre><pre><code class="nohighlight hljs">23-element SystemComponentTableCol{StaticArraysCore.SVector{3, Float32}}:
 [-8.9053415f-10, -3.7217035f-10, 4.139505f-10]
 [7.8021095f-10, 5.121153f-11, -4.5226357f-11]
 [2.1271644f-9, 7.604931f-10, -1.7229931f-9]
 [6.35672f-8, 4.1203474f-8, -1.4751437f-7]
 [-6.499216f-11, -9.3102845f-11, 5.374651f-11]
 [4.2136683f-11, -7.511121f-11, 1.08262434f-10]
 [8.747169f-12, -6.845735f-11, 8.273652f-11]
 [6.9892536f-11, 1.4578987f-11, -3.084564f-11]
 [-1.9595295f-10, -1.1358163f-10, -1.1052923f-10]
 [7.265452f-11, 4.82974f-11, -4.4509858f-11]
 ⋮
 [2.466124f-10, -1.1778086f-9, 2.6044453f-9]
 [8.27785f-10, -5.424906f-10, 8.765798f-10]
 [3.351959f-11, -1.4663636f-10, 3.1680897f-11]
 [4.1687837f-11, 5.738371f-12, 1.0522515f-10]
 [7.105667f-11, -7.694347f-11, 1.3604341f-10]
 [-4.5483453f-10, 7.660909f-10, -6.81682f-10]
 [9.818543f-12, -2.6953412f-10, 2.1820956f-10]
 [-6.470714f-8, -4.2964025f-8, 1.4709109f-7]
 [-2.1067495f-10, 1.2029508f-10, -2.3378374f-10]</code></pre><h2 id="Potential-energy-computation"><a class="docs-heading-anchor" href="#Potential-energy-computation">Potential energy computation</a><a id="Potential-energy-computation-1"></a><a class="docs-heading-anchor-permalink" href="#Potential-energy-computation" title="Permalink"></a></h2><p>Similarly, potential energies can be computed via <code>compute_energy!</code>:</p><pre><code class="language-julia hljs">compute_energy!(ff)</code></pre><pre><code class="nohighlight hljs">1425.6062f0</code></pre><p>This will return the total energy of the system (in kJ/mol). Additionally, the force field object keeps track of individual contributions of force field components, which can be queried like this:</p><pre><code class="language-julia hljs">ff.energy</code></pre><pre><code class="nohighlight hljs">Dict{String, Float32} with 7 entries:
  &quot;Angle Bends&quot;      =&gt; 5.40767
  &quot;Hydrogen Bonds&quot;   =&gt; 0.0
  &quot;Bond Stretches&quot;   =&gt; 1.36306
  &quot;Van der Waals&quot;    =&gt; 1493.18
  &quot;Improper Torsion&quot; =&gt; 3.99017f-6
  &quot;Electrostatic&quot;    =&gt; -85.1467
  &quot;Proper Torsion&quot;   =&gt; 10.7981</code></pre><h2 id="Structure-optimization"><a class="docs-heading-anchor" href="#Structure-optimization">Structure optimization</a><a id="Structure-optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Structure-optimization" title="Permalink"></a></h2><p>The force field object can also be used to find a structure minimizing the total energy of the system:</p><pre><code class="language-julia hljs">optimize_structure!(ff)
compute_energy!(ff)</code></pre><pre><code class="nohighlight hljs">-374.3145f0</code></pre><p>The opmitization function also updates the atom positions correspondingly such that the structure can be visualized in its optimized state, e.g., through <a href="https://github.com/hildebrandtlab/BiochemicalVisualization.jl">BiochemicalVisualization.jl</a>.</p><p>We provide a variant of the optimization function above to only optimize the positions of hydrogen atoms:</p><pre><code class="language-julia hljs">optimize_hydrogen_positions!(ff)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../handle_molecules/">« How to handle molecules</a><a class="docs-footer-nextpage" href="../../public/system/">Biomolecular systems »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Sunday 13 July 2025 01:33">Sunday 13 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
